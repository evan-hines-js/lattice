# Istio Ambient FIPS Override Values
# Use with: helm install istio-base istio/base -f values.yaml
#
# All images use FIPS 140-3 validated crypto:
# - istiod (pilot): Go 1.24 native FIPS
# - proxyv2 (Envoy): BoringSSL FIPS - used for waypoint proxies
# - ztunnel: aws-lc-rs FIPS (Rust) - L4 secure overlay
#
# Ambient Architecture:
# - ztunnel (DaemonSet): L4 mTLS, runs on every node
# - waypoint (Envoy/proxyv2): L7 processing, optional per-namespace

global:
  hub: ghcr.io/evan-hines-js/istio-fips
  tag: "1.24.2"

# Control plane
pilot:
  image: pilot

# Envoy proxy - used for waypoint proxies in ambient mode
# Waypoint = Envoy deployed via Gateway API for L7 features
proxy:
  image: proxyv2

# ztunnel - L4 secure overlay (Rust + aws-lc-rs FIPS)
# Handles mTLS termination/origination at L4
ztunnel:
  image: ztunnel

# Enable ambient mode
profile: ambient

# Enforce FIPS mode at runtime for Go components (istiod)
meshConfig:
  defaultConfig:
    proxyMetadata:
      GODEBUG: "fips140=only"
  # mTLS everywhere (required for FIPS compliance)
  enableAutoMtls: true

# Strict mTLS policy - no plaintext allowed
# This is critical for FIPS - all traffic must be encrypted
peerAuthentication:
  mtls:
    mode: STRICT

# Waypoint proxy defaults (uses proxyv2/Envoy image)
# Deploy per-namespace with: istioctl waypoint apply --namespace <ns>
defaults:
  waypoint:
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
