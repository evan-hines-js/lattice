# Proxmox management cluster for E2E testing
apiVersion: lattice.dev/v1alpha1
kind: LatticeCluster
metadata:
  name: e2e-mgmt
spec:
  providerRef: proxmox
  provider:
    kubernetes:
      version: "1.32.0"
      bootstrap: kubeadm
      # certSANs auto-populated from controlPlaneEndpoint and endpoints.host
    config:
      proxmox:
        secretRef:
          name: proxmox-credentials
          namespace: capmox-system
        sshAuthorizedKeys:
          - "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAID1f8eVKp5YCAtis77YO/oHhWvzAiimDzlDqhtD+85YR evan.hines.dev@gmail.com"
        sourceNode: "poweredge-lg"
        templateId: 9000
        # kube-vip VIP for K8s API server
        controlPlaneEndpoint: "10.0.0.100"
        bridge: "vmbr0"
        # Node IPs assigned by CAPMOX (extra headroom for failed test cleanup)
        ipv4Pool:
          range: "10.0.0.101-105/24"
          gateway: "10.0.0.1"
        dnsServers:
          - "10.0.0.1"
        virtualIpNetworkInterface: "ens18"
        cpCores: 16
        cpMemoryMib: 32768
        cpDiskSizeGb: 50
        workerCores: 16
        workerMemoryMib: 32768
        workerDiskSizeGb: 100
  nodes:
    controlPlane: 1
    workerPools:
      default:
        replicas: 1
  parentConfig:
    # Must be in Cilium LB pool (auto-derived as 10.0.0.200/27 from gateway)
    host: "10.0.0.201"
    grpcPort: 50051
    bootstrapPort: 8443
    service:
      type: LoadBalancer
