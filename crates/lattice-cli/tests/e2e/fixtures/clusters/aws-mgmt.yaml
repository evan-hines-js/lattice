# AWS management cluster for E2E testing
# Uses CAPA (Cluster API Provider AWS) with NLB and BYOI
apiVersion: lattice.dev/v1alpha1
kind: LatticeCluster
metadata:
  name: e2e-mgmt
spec:
  monitoring:
    enabled: false
  backups:
    enabled: false
  providerRef: aws
  provider:
    kubernetes:
      version: "1.32.0"
      bootstrap: kubeadm
      certSANs:
        - "127.0.0.1"
        - "localhost"
    config:
      aws:
        region: "us-west-2"
        sshKeyName: "lattice-e2e"
        # BYOI: share VPC/subnets across clusters
        vpcId: "vpc-02334e828aa108521"
        subnetIds:
          # Private subnets (for nodes)
          - "subnet-0baada5edd89b23c1"
          - "subnet-0b0d0d0ff4909e119"
          - "subnet-0d4feb8582c12782d"
          # Public subnets (for load balancers)
          - "subnet-0482c8a493e96c631"
          - "subnet-08cb587698200615b"
          - "subnet-002e2a39388d962c9"
  nodes:
    controlPlane:
      replicas: 1
      instanceType:
        name: m7i-flex.large
      rootVolume:
        sizeGb: 50
        type: "gp3"
    workerPools:
      default:
        replicas: 1
        instanceType:
          name: t3.small
        rootVolume:
          sizeGb: 50
          type: "gp3"
  parentConfig:
    # host is auto-discovered from NLB
    grpcPort: 50051
    bootstrapPort: 8443
    service:
      type: LoadBalancer
