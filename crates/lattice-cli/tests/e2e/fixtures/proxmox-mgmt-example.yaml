# Proxmox management cluster example
# Copy this file and fill in your values
#
# Prerequisites:
# 1. Create a Proxmox API token
# 2. Create the credentials secret (see below)
# 3. Have a VM template with cloud-init support
# 4. Allocate a VIP for the control plane
#
# Create credentials secret:
# kubectl create secret generic proxmox-credentials \
#   --from-literal=url='https://proxmox.example.com:8006' \
#   --from-literal=token='user@pam!token-name' \
#   --from-literal=secret='your-token-secret'
apiVersion: lattice.dev/v1alpha1
kind: LatticeCluster
metadata:
  name: mgmt-cluster
spec:
  provider:
    kubernetes:
      version: "1.32.0"
      bootstrap: kubeadm
      certSANs:
        - "127.0.0.1"
        - "localhost"
        - "10.0.0.100"  # Your control plane VIP
    config:
      proxmox:
        # Credentials via secret reference
        secretRef:
          name: proxmox-credentials
          namespace: lattice-system
        # Proxmox infrastructure settings
        sourceNode: "pve"              # Your Proxmox node name
        templateId: 9000               # VM template ID with cloud-init
        controlPlaneEndpoint: "10.0.0.100"  # VIP for this cluster
        storage: "local-lvm"           # Storage backend
        bridge: "vmbr0"                # Network bridge
        # IP allocation for VMs
        ipv4Addresses:
          - "10.0.0.101"               # Control plane node
          - "10.0.0.102"               # Worker node
        ipv4Prefix: 24
        ipv4Gateway: "10.0.0.1"
        dnsServers:
          - "10.0.0.1"
        virtualIpNetworkInterface: "ens18"
        # VM sizing
        cpCores: 16
        cpMemoryMib: 32768
        cpDiskSizeGb: 50
        workerCores: 16
        workerMemoryMib: 32768
        workerDiskSizeGb: 100
        # Optional: SSH access for debugging
        sshAuthorizedKeys:
          - "ssh-ed25519 AAAA... your-key"
  nodes:
    controlPlane: 1
    workers: 1
  # Management cluster endpoints for Lattice services
  endpoints:
    host: 10.0.0.100
    grpcPort: 50051
    bootstrapPort: 8443
    service:
      type: LoadBalancer
